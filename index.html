<!doctype html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: #210706;
    }

    /* Center the sketch perfectly */
    #wrap {
      width: 100%;
      height: 100%;
      display: grid;
      place-items: center;
    }

    canvas {
      display: block;
      touch-action: none;
      -webkit-tap-highlight-color: transparent;
    }
  </style>
</head>
<body>
  <div id="wrap"></div>

  <script src="https://cdn.jsdelivr.net/npm/p5@1.9.4/lib/p5.min.js"></script>
  <script>
    // Prevent double initialization in embedded environments
    if (!window.__noiseMapSketchInit) {
      window.__noiseMapSketchInit = true;

      new p5((p) => {
        let noiseScale = 0.01;

        // De-dupe press events (Framer sometimes fires twice)
        let lastFire = 0;
        const FIRE_GAP_MS = 60;

        function fireOnce(fn) {
          const now = performance.now();
          if (now - lastFire < FIRE_GAP_MS) return;
          lastFire = now;
          fn();
        }

        function fitSize() {
          // Fit to the available viewport (embed frame)
          const w = document.documentElement.clientWidth;
          const h = document.documentElement.clientHeight;
          return Math.floor(Math.min(w, h));
        }

        function renderNoise() {
          // Important: keep pixelDensity 1 for predictable pixel indexing
          p.pixelDensity(1);
          p.loadPixels();

          const W = p.width;
          const H = p.height;

          for (let y = 0; y < H; y++) {
            for (let x = 0; x < W; x++) {
              const n = p.noise(x * noiseScale, y * noiseScale);
              const i = 4 * (y * W + x);

              if (n > 0.5) {
                // water: 139,157,204
                p.pixels[i + 0] = 139;
                p.pixels[i + 1] = 157;
                p.pixels[i + 2] = 204;
                p.pixels[i + 3] = 255;
              } else {
                // land: 33,7,6
                p.pixels[i + 0] = 33;
                p.pixels[i + 1] = 7;
                p.pixels[i + 2] = 6;
                p.pixels[i + 3] = 255;
              }
            }
          }

          p.updatePixels();
        }

        p.setup = () => {
          const size = fitSize();

          const c = p.createCanvas(size, size, p.P2D);
          c.parent("wrap");

          p.noLoop();
          p.noStroke();

          // Initial draw
          p.redraw();
        };

        p.draw = () => {
          p.background("#210706");
          renderNoise();
        };

        // Responsive resizing
        p.windowResized = () => {
          const size = fitSize();
          p.resizeCanvas(size, size);
          p.redraw();
        };

        // Press/tap interaction (ONLY on press)
        p.mousePressed = () => {
          fireOnce(() => p.redraw());
          return false;
        };

        p.touchStarted = () => {
          fireOnce(() => p.redraw());
          return false; // prevents scroll + synthetic click
        };
      });
    }
  </script>
</body>
</html>
