<!doctype html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: #210706;
    }
    canvas {
      display: block;
      touch-action: none;
      -webkit-tap-highlight-color: transparent;
    }
  </style>
</head>
<body>
  <div id="wrap"></div>

  <script src="https://cdn.jsdelivr.net/npm/p5@1.9.4/lib/p5.min.js"></script>
  <script>
    // Prevent double initialization in embedded environments
    if (!window.__noiseFullScreenInit) {
      window.__noiseFullScreenInit = true;

      new p5((p) => {
        // Your original scale
        const noiseScale = 0.01;

        // We change the noise by shifting the sampling origin each click/tap
        let seedX = 0;
        let seedY = 0;

        // De-dupe press events (Framer can fire twice)
        let lastFire = 0;
        const FIRE_GAP_MS = 70;

        function fireOnce(fn) {
          const now = performance.now();
          if (now - lastFire < FIRE_GAP_MS) return;
          lastFire = now;
          fn();
        }

        function resizeToScreen() {
          // Fill the entire available area (embed viewport)
          const w = Math.max(1, document.documentElement.clientWidth);
          const h = Math.max(1, document.documentElement.clientHeight);
          p.resizeCanvas(w, h);
        }

        function renderNoise() {
          p.pixelDensity(1);
          p.loadPixels();

          const W = p.width;
          const H = p.height;

          for (let y = 0; y < H; y++) {
            for (let x = 0; x < W; x++) {
              const n = p.noise((x + seedX) * noiseScale, (y + seedY) * noiseScale);
              const i = 4 * (y * W + x);

              if (n > 0.5) {
                // water 139, 157, 204
                p.pixels[i + 0] = 139;
                p.pixels[i + 1] = 157;
                p.pixels[i + 2] = 204;
                p.pixels[i + 3] = 255;
              } else {
                // land 33, 7, 6
                p.pixels[i + 0] = 33;
                p.pixels[i + 1] = 7;
                p.pixels[i + 2] = 6;
                p.pixels[i + 3] = 255;
              }
            }
          }

          p.updatePixels();
        }

        function regenerate() {
          // Move the noise window so the pattern changes without needing p.noiseSeed
          seedX = p.floor(p.random(0, 100000));
          seedY = p.floor(p.random(0, 100000));
          p.redraw();
        }

        p.setup = () => {
          // Create full-screen canvas immediately
          const w = Math.max(1, document.documentElement.clientWidth);
          const h = Math.max(1, document.documentElement.clientHeight);
          const c = p.createCanvas(w, h, p.P2D);
          c.parent("wrap");

          p.noLoop();

          // Initial render once (then only changes on click/tap)
          regenerate();
        };

        p.draw = () => {
          // Optional background (your land color already covers pixels)
          p.background("#210706");
          renderNoise();
        };

        // Keep it full-screen and not cut off
        p.windowResized = () => {
          resizeToScreen();
          p.redraw(); // keep current seed, just re-render at new size
        };

        // Desktop: change noise on press/click
        p.mousePressed = () => {
          fireOnce(regenerate);
          return false;
        };

        // Phone/tablet: change noise on touch
        p.touchStarted = () => {
          fireOnce(regenerate);
          return false;
        };
      });
    }
  </script>
</body>
</html>
